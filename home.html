
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>zSlicer</title>

    <script rel="stylesheet" type="text/css" href="/home.css"></script>

      <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
      <script type="text/javascript">

          function initPinTable(){
            var pinListJson = [{id:23, PinNum:"P23", Description:"GPIO23/VPSIMOSI", PWM:true,ADC:false},
                             {id:22, PinNum:"P22", Description:"GPIO22", PWM:true,ADC:false},
                             {id:1, PinNum:"TX", Description:"GPIO1/TX0", PWM:true,ADC:false},
                             {id:3, PinNum:"RX", Description:"GPIO3/RX0", PWM:true,ADC:false},
                             {id:21, PinNum:"P21", Description:"GPIO21", PWM:true,ADC:false},
                             {id:19, PinNum:"P19", Description:"GPIO19/VPSIMISO", PWM:true,ADC:false},
                             {id:18, PinNum:"P18", Description:"GPIO18/VPSI SCK", PWM:true,ADC:false},
                             {id:5, PinNum:"P5", Description:"GPIO5/VPSI SS", PWM:true,ADC:false},
                             {id:17, PinNum:"P17", Description:"GPIO17", PWM:true,ADC:false},
                             {id:16, PinNum:"P16", Description:"GPIO16", PWM:true,ADC:false},
                             {id:5, PinNum:"P4", Description:"GPIO4/ADC10/TOUCH0", PWM:true,ADC:10},
                             {id:0, PinNum:"P0", Description:"GPIO0/ADC11/TOUCH1", PWM:true,ADC:11},
                             {id:2, PinNum:"P2", Description:"GPIO2/ADC12/TOUCH2", PWM:true,ADC:12},
                             {id:15, PinNum:"P15", Description:"GPIO15/ADC13/TOUCH3", PWM:true,ADC:13},
                             {id:8, PinNum:"SD1", Description:"GPIO8/FLASH D1", PWM:false,ADC:false},
                             {id:7, PinNum:"SD0", Description:"GPIO7/FLASH D0", PWM:false,ADC:false},
                             {id:6, PinNum:"CLK", Description:"GPIO6/FLASH SCK", PWM:false,ADC:false}];


            var pinTable = document.getElementById("pinTable");
            while (pinTable.firstChild) {
                pinTable.removeChild(pinTable.firstChild);
            }

            var header = "<tr><th>Pin</th>"
                +"<th>Description</th>"
                +"<th>Get Pin Value</th>"
                +"<th>Set Pin Value</th>"
                +"<th><div>PWM</div><div>Freq=1HZ~1kHZ, Duty=0-1024</div></th>"
                +"<th>Get ADC Value</th>"
                +"</tr>";
            $("#pinTable").append(header);

            for(var i=0;i<pinListJson.length;i++){
                var tr="<tr>";
                var td1="<td>"+pinListJson[i]["PinNum"]+"</td>";
                var td2="<td>"+pinListJson[i]["Description"]+"</td>";
                var td3="<td><a onclick=\"getPinValue("+pinListJson[i]["id"]+")\" "
                        +"class=\"smbutton\">Get</a><div id=\"getResultPin"+pinListJson[i]["id"]+"\""
                        +"></div></td>";
                var td4="<td><input type=\"radio\" value=\"0\" name=\"group"+pinListJson[i]["id"]+"\">0"
                        +"<input type=\"radio\" value=\"1\" name=\"group"+pinListJson[i]["id"]+"\">1"
                        +"<a onclick=\"setPinValue("+pinListJson[i]["id"]+")\" class=\"smbutton\">Set</a>"
                        +"<div id=\"setResultPin"+pinListJson[i]["id"]+"\"></div></td>";
                if(pinListJson[i]["PWM"]==true){
                    var td5="<td>Freq:<input type=\"text\" name=\"freq"+pinListJson[i]["id"]+"\" maxlength=4 size=4> "
                    +"Duty:<input type=\"text\" name=\"duty"+pinListJson[i]["id"]+"\" maxlength=4 size=4>"
                    +"<a onclick=\"setPWMValue("+pinListJson[i]["id"]+")\" class=\"smbutton\">Enable</a></td>";
                }else{
                    var td5="<td>N/A</td>";
                }
                if(pinListJson[i]["ADC"]==false){
                    var td6="<td>N/A</td>";
                }else{
                    var td6="<td><a onclick=\"getPinADCValue("+pinListJson[i]["ADC"]+")\" "
                        +"class=\"smbutton\">Get ADC</a><div id=\"getADCResultPin"+pinListJson[i]["ADC"]+"\""
                        +"></div></td>";
                }
                var endtr = "</tr>";
                $("#pinTable").append(tr+td1+td2+td3+td4+td5+td6+endtr);

            }
          }

          function getWifiProfile() {
             var jqxhr = $.getJSON( "/wifi", function(data) {
                console.log( "success" );
                console.log( data );
                document.getElementById("wifi_id").value = data.ssid;
                document.getElementById("wifi_pwd").value = data.password;
             })
            .done(function() {
                console.log( "/wifi GET request done" );
            })
            .fail(function() {
                console.log( "/wifi GET request error" );
            })
            .always(function() {
                console.log( "/wifi GET request complete" );
            });

          }

          function wifiConfirm(){
             var jqxhr = $.get( "/setwifi", {
                    ssid: document.getElementById("wifi_id").value,
                    password: document.getElementById("wifi_pwd").value
              })
             .done(function(data) {
                console.log( "/setwifi POST request done" );
                console.log(data);
             })
             .fail(function() {
                console.log( "/setwifi POST request error" );
             })
             .always(function() {
                console.log( "/setwifi POST request complete" );
             });
          }

         function reset(){
             var jqxhr = $.get( "/reset", function(data) {
                console.log( data );
             })
            .done(function() {
                console.log( "/reset GET request done" );
            })
            .fail(function() {
                console.log( "/reset GET request error" );
            })
            .always(function() {
                console.log( "/reset GET request complete" );
            });
          }

          function getPinValue(pin){
             var jqxhr = $.get( "/getPinValue", {
                    pin: pin,
              })
             .done(function(data) {
                console.log( "/getPinValue GET request done" );
                console.log(data);
                var idTag = "getResultPin"+pin;
                document.getElementById(idTag).innerHTML = data;
             })
             .fail(function() {
                console.log( "/getPinValue GET request error" );
             })
             .always(function() {
                console.log( "/getPinValue GET request complete" );
             });
          }

          function getPinADCValue(pin){
             var jqxhr = $.get( "/getPinADCValue", {
                    pin: pin,
              })
             .done(function(data) {
                console.log( "/getPinADCValue GET request done" );
                console.log(data);
                var idTag = "getADCResultPin"+pin;
                document.getElementById(idTag).innerHTML = data;
             })
             .fail(function() {
                console.log( "/getPinADCValue GET request error" );
             })
             .always(function() {
                console.log( "/getPinADCValue GET request complete" );
             });
          }

          function setPinValue(pin){
             var groupName = "group"+pin;
             var targetValue = document.querySelector('input[name='+groupName+']:checked').value;
             console.log("target Value is "+targetValue);
             var jqxhr = $.get( "/setPinValue", {
                    pin: pin,
                    value: targetValue,
              })
             .done(function(data) {
                console.log( "/setPinValue GET request done" );
                console.log(data);
                var idTag = "setResultPin"+pin;
                document.getElementById(idTag).innerHTML = data;
             })
             .fail(function() {
                console.log( "/setPinValue GET request error" );
             })
             .always(function() {
                console.log( "/setPinValue GET request complete" );
             });
          }

           function setPWMValue(pin){
             var freqValue = "freq"+pin;
             var dutyValue = "duty"+pin;
             var targetFreqValue = document.querySelector('input[name='+freqValue+']').value;
             var targetDutyValue = document.querySelector('input[name='+dutyValue+']').value;
             console.log("target freq is "+targetFreqValue + " and target duty is " + targetDutyValue);
             var jqxhr = $.get( "/setPWMValue", {
                    pin: pin,
                    freq: targetFreqValue,
                    duty: targetDutyValue,
              })
             .done(function(data) {
                console.log( "/setPWMValue GET request done" );
                console.log(data);
                var idTag = "setPWMValue"+pin;
                document.getElementById(idTag).innerHTML = "Done!";
             })
             .fail(function() {
                console.log( "/setPWMValue GET request error" );
             })
             .always(function() {
                console.log( "/setPWMValue GET request complete" );
             });
          }

          function navSwitch(nr) {
            var itemsArr = document.getElementsByClassName('pageDetail');
            for(var i = 0; i < itemsArr.length; i++) {
                var item = itemsArr[i];
                if(i != nr) {
                    item.style.display = 'none';
                } else {
                     item.style.display = 'block';
                }
            }

            var submenuArr = document.getElementsByClassName('submenu');
            for(var i = 0; i < submenuArr.length; i++) {
                var menu = submenuArr[i];
                if(i == nr) {
                    if(!menu.classList.contains('active')) {
                         menu.classList.add('active');
                    }
                } else {
                    if(menu.classList.contains('active')){
                        menu.classList.remove('active');
                    }
                }
            }

            if(nr==1){
               getWifiProfile();
            }else if(nr==2){
               initPinTable();
            }
          }
      </script>
  </head>

  <body>

  <div id="wrapper">
        <div id="navigation">
            <ul id="menu-bar">
              <li class="active submenu"><a onclick="navSwitch(0)"> ESP32 Home </a></li>
              <li class="submenu"><a onclick="navSwitch(1)"> Wifi Config </a></li>
              <li class="submenu"><a onclick="navSwitch(2)"> Control </a></li>
              <li class="submenu"><a onclick="navSwitch(3)"> PIN Map </a></li>
                <li class="submenu"><a onclick="navSwitch(4)"> About US </a></li>
            </ul>
        </div>
        <div id="content">
            <div id="home_page" class="pageDetail" style="display:block">
                <p></p>
                <h1>Getting start with ESP32</h1>
                <p>Wonderful control panel for ESP32</p>
                <p><a onclick="navSwitch(2)" class="bigbutton">Make use of it today</a></p>
            </div>
            <div id="wifi_config" class="pageDetail">
                <p/>
                <h2>Config your WIFI profile:</h2>
                <p>Set the password to 'none' if you want to startup as HOTSPOT</p>
                <p>UserID: <input type="text" class="text-input" id="wifi_id" value=""></p>
                <p>Password: <input type="text" class="text-input" id="wifi_pwd" value=""></p>
                <p/>
                <p>
                    <a onclick="wifiConfirm()" class="bigbutton">Confirm</a>
                    <a onclick="reset()"  class="bigbutton">Reset</a>
                </p>
                <p></p>
            </div>
            <div id="control_page" class="pageDetail">
                <br/>
                <table border="1" id="pinTable"></table>
            </div>
            <div id="pinmap_page" class="pageDetail">
                <img src="http://wiki.ai-thinker.com/_media/esp32/boards/nodemcu/nodemcu_32s_pin.png?cache="/>
            </div>
            <div id="about_page" class="pageDetail">
                <p><a href="http://wiki.ai-thinker.com/esp32/boards/nodemcu_32s">NodeMCU ESP32 Datasheet</a></p>
                <p><a href="https://github.com/abigail830/ESP32">Github: https://github.com/abigail830/ESP32 </a></p>
            </div>
        </div>
        <div id="footer">
            <p>&copy; Beets3d China 2017</p>
        </div>
    </div>

  </body>
</html>

